# $Revision$
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
#
# (c) Tim Brown, 2012
# <mailto:timb@nth-dimension.org.uk>
# <http://www.nth-dimension.org.uk/> / <http://www.machine.org.uk/>
#
# Supports: Linux, AIX

shadow_list () {
	pattern="$1"
	if [ "`uname`" = "AIX" ]
	then
		cat "${filecacherootpath}/etc/security/passwd" | grep "^[A-Za-z0-9]" | grep "[A-Za-z0-9]:$" | grep "${pattern}" | sed "s/:$//g" | while read shadowusername
		do
			printf "${shadowusername}\n"
		done
	else
		oldifs="${IFS}"
		IFS=":"
		cat "${filecacherootpath}/etc/shadow" | grep -v "^#" | grep -v "^$" | grep "${pattern}" | while read shadowusername dummy
		do
			IFS="${oldifs}"
			printf "${shadowusername}\n"
			IFS=":"
		done
		IFS="${oldifs}"
	fi
}

shadow_show_hash () {
	pattern="$1"
	if [ "`uname`" = "AIX" ]
	then
		passwordflag=0
		cat "${filecacherootpath}/etc/security/passwd" | while read line
		do
			if [ "${passwordflag}" -eq 1 ]
			then
				if [ "`printf "${line}" | grep \"password = \"`" != "" ]
				then
					passwordflag=0
					printf "${line}\n" | while read dummy dummy shadowhash
					do
						printf "${shadowhash}\n"
					done
				fi
			else
				if [ "${line}" = "${pattern}:" ]
				then
					passwordflag=1
				fi
			fi
		done
	else
		oldifs="${IFS}"
		cat "${filecacherootpath}/etc/shadow" | grep -v "^#" | grep -v "^$" | while read shadowusername shadowhash shadowuserid shadowgroupid shadowgecos shadowhomefilename shadowshellfilename
		do
			IFS="${oldifs}"
			if [ "${shadowusername}" = "${pattern}" ]
			then
				printf "${shadowhash}\n"
			fi
			IFS=":"
		done
		IFS="${oldifs}"
	fi
}
